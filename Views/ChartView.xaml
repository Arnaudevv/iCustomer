<UserControl x:Class="iCustomer.Views.ChartView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf">

    <Grid Background="{StaticResource PrimaryDark}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header with title and comparison selector -->
            <RowDefinition Height="*"/>
            <!-- Chart area -->
            <RowDefinition Height="Auto"/>
            <!-- Back button -->
        </Grid.RowDefinitions>

        <!-- Header: customer name on the left, comparison ComboBox on the right -->
        <Border Grid.Row="0"
                Background="{StaticResource SecondaryDark}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                Padding="24,16">
            <Grid>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Annual Expense Report"
                               Foreground="{StaticResource TextPrimary}"
                               FontFamily="Segoe UI"
                               FontSize="20"
                               FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding CustomerFullName}"
                               Foreground="{StaticResource TextSecondary}"
                               FontFamily="Segoe UI"
                               FontSize="13"
                               Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Selecting a customer here adds a second series to the chart -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <TextBlock Text="Compare with:"
                               Foreground="{StaticResource TextSecondary}"
                               FontFamily="Segoe UI"
                               FontSize="13"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <ComboBox Style="{StaticResource DarkComboStyle}"
                              ItemsSource="{Binding AvailableCustomers}"
                              SelectedItem="{Binding CompareCustomer, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock FontFamily="Segoe UI" FontSize="13"
                                           Foreground="{StaticResource TextPrimary}">
                                    <Run Text="{Binding Name}"/>
                                    <Run Text="{Binding LastName}"/>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- LiveCharts bar chart — Series, labels, and formatter all come from the ViewModel -->
        <Border Grid.Row="1"
                Margin="20,20,20,10"
                Background="{StaticResource SecondaryDark}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="1">
            <lvc:CartesianChart Series="{Binding SeriesCollection}"
                                Foreground="{StaticResource TextPrimary}"
                                LegendLocation="Top"
                                Margin="16">
                
                <lvc:CartesianChart.DataTooltip>
                    <lvc:DefaultTooltip Background="#2D2D30" 
                            Foreground="White" 
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            FontSize="12"
                            FontFamily="Segoe UI"
                            BulletSize="10">
                    </lvc:DefaultTooltip>
                </lvc:CartesianChart.DataTooltip>
                
                <lvc:CartesianChart.AxisX>
                    <lvc:Axis Labels="{Binding MonthLabels}"
                              Foreground="{StaticResource TextPrimary}"
                              FontFamily="Segoe UI"
                              FontSize="12">
                        <lvc:Axis.Separator>
                            <lvc:Separator StrokeThickness="0"/>
                        </lvc:Axis.Separator>
                    </lvc:Axis>
                </lvc:CartesianChart.AxisX>
                <lvc:CartesianChart.AxisY>
                    <lvc:Axis LabelFormatter="{Binding CurrencyFormatter}"
                              Foreground="{StaticResource TextPrimary}"
                              FontFamily="Segoe UI"
                              FontSize="12"
                              MinValue="0">
                        <lvc:Axis.Separator>
                            <lvc:Separator Stroke="{StaticResource BorderColor}" StrokeThickness="1"/>
                        </lvc:Axis.Separator>
                    </lvc:Axis>
                </lvc:CartesianChart.AxisY>
            </lvc:CartesianChart>
        </Border>

        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="20,0,20,20">
            <Button Command="{Binding BackCommand}"
                    Style="{StaticResource BackButtonStyle}"
                    Content="← Back to Customers"/>
        </StackPanel>
    </Grid>
</UserControl>
